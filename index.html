<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="icon" href="assets/eevee.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/eevee.png" type="image/x-icon">

    <style>
        body {
            background: #2e225b;
            font-family: Arial, Helvetica, sans-serif;
        }

        .main {
            box-sizing: border-box;
        }

        button {
            z-index: 50;
            background-color: #3b3b3b; 
            color: white;
            border: none;
            position: absolute;
            opacity: 1;
        }
        button:hover {
            background-color: #453a7f!important; 
        }

        .script {
            width: 100%;
            height: 20px;
        }
        .script:hover {
            background-color: #453a7f!important;
        }

        #headerGrid, #buttonsGrid {
            background-color: #3c2d6d; 
        }

        #headerLabel, #headerStatusLabel {
            color: white;
        }

        #headerLogo {
            width: 28px;
            height: 30px;
            position: absolute;
            top: 2px;
            left: 10px;
            opacity: 1;
            content: url('assets/eevee.png'); 
        }
    </style>
</head>
<body>
    <div class="main" id="main" style="width: 720px; height: 335px; background-color: #2e225b; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <div style="position: relative; z-index: 2; top: -60px">
            <ul id="synScripts" style="list-style-type: none; background-color: #3d3d3d; color: white; width: 115px; height: 261px; position: absolute; top: 25px; right: 8px; opacity: 1; border: 1px solid #333333; padding: 0 0; font-size: 14px; text-align: center;">
                <li style="display: flex; flex-direction: column;">
                    <span class="script">Infinite Yield</span>
                    <span class="script">Dex</span>
                </li>
            </ul>
            <div id="synEditorGrid" style="margin: 55px 130px 35px 10px; top: 40px; left: 0; position: relative;">
                <iframe id="editorFrame" src="bin/Editor.html" style="width: 580px; height: 261px; outline: none; border: none;"></iframe>
            </div>
            <div id="headerGrid" style="position: absolute; top: 0; display: flex; justify-content: center; background-color: #3c2d6d; width: 100%; height: 36px;">
                <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; flex-direction: row;">
                    <button id="closeButton" style="right: 30px; top: 10px; width: 20px; height: 20px;">X</button>
                    <button id="minimizeButton" style="right: 55px; top: 10px; width: 20px; height: 20px;">_</button>
                    <img id="headerLogo">
                    <div style="position: relative; display:flex; width: 100%; height: 100%; justify-content: center; align-items: center; gap: 5px; pointer-events: none;">
                        <div id="headerLabel" style="font-size: 14px;">vylara - v.2.5.14</div>
                    </div>
                    <div id="headerStatusLabel"></div>
                </div>
            </div>
            <div id="buttonsGrid">
                <button id="executeButton" style="left: 10px; top: 305px; width: 80px;">Execute</button>
                <button id="clearButton" style="left: 95px; top: 305px; width: 80px;" onclick="clearButton_Click()">Clear</button>
                <button id="openButton" style="left: 180px; top: 305px; width: 80px;" onclick="openButton_Click()">Open File</button>
                <button id="executeFileButton" style="left: 265px; top: 305px; width: 80px; font-size: 12px;" onclick="executeFileButton_Click()">Execute File</button>
                <button id="saveFileButton" style="left: 350px; top: 305px; width: 80px;" onclick="saveFileButton_Click()">Save File</button>
                <button id="optionsButton" style="left: 435px; top: 305px; width: 80px;" onclick="optionsButton_Click()">Options</button>
                <button id="attachButton" style="left: 546px; top: 305px; width: 80px;">Attach</button>
                <button id="scriptHubButton" style="left: 631px; top: 305px; width: 80px;" onclick="scriptHubButton_Click()">Script Hub</button>
            </div>
        </div>
    </div>

    <script>
        function setTextToEditor(text) {
            var editorFrame = document.getElementById('editorFrame');
            var iframeDocument = editorFrame.contentDocument || editorFrame.contentWindow.document;

            var setTextFunction = iframeDocument.defaultView.SetText;
            setTextFunction(text);
        }

        function getTextFromEditor() {
            var editorFrame = document.getElementById('editorFrame');
            var iframeDocument = editorFrame.contentDocument || editorFrame.contentWindow.document;

            var getTextFunction = iframeDocument.defaultView.GetText;
            var text = getTextFunction();
            return text
        }

        function clearTextFromEditor() {
            var editorFrame = document.getElementById('editorFrame');
            var iframeDocument = editorFrame.contentDocument || editorFrame.contentWindow.document;

            var clearTextFunction = iframeDocument.defaultView.ClearText;
            clearTextFunction();
        }

        function clearButton_Click()
        {
            clearTextFromEditor()
        }

        function openButton_Click()
        {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.lua';
            input.click();

            input.addEventListener('change', function(event) {
                var file = event.target.files[0];

                if (file) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        var text = e.target.result;
                        setTextToEditor(text);
                    };

                    reader.readAsText(file);
                }
            });
        }

        function executeFileButton_Click()
        {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.lua';
            input.click();

            input.addEventListener('change', function(event) {
                var file = event.target.files[0];

                if (file) {
                    var reader = new FileReader();

                    reader.onload = function(e) {
                        var text = e.target.result;
                        pywebview.api.execute(text);
                    };
                    reader.readAsText(file);
                }
            });
        }

        function saveFileButton_Click()
        {

        }

        function optionsButton_Click()
        {}

        function scriptHubButton_Click()
        {}

        function closeButton_Click()
        {
            pywebview.api.closeWindow()
        }

        function minimizeButton_Click()
        {
            pywebview.api.minimizeWindow()
        }

        const inject = document.getElementById("attachButton");
        const execute = document.getElementById("executeButton");

        inject.onclick = () => {
            pywebview.api.inject();
        };

        execute.onclick = () => {
            pywebview.api.execute(getTextFromEditor());
        };
    </script>
</body>
</html>
